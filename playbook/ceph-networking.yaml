- name: Configure ens18 and ens19 interfaces
  hosts: all  # Replace with the appropriate host group name
  become: true
  vars:
    available_ip_range_start: 100
    available_ip_range_end: 130

    network_connection_static:
      - name: static-network
        type: ethernet
        state: up
        ip:
          dhcp: no
          address: "{{ selected_ip }}/16"
          gateway4: 172.200.0.1
          dns:
            - 172.200.0.1

  tasks:
    - name: Get available IP
      set_fact:
        selected_ip: "172.200.0.{{ item }}"
      loop: "{{ range(available_ip_range_start, available_ip_range_end) }}"
      when: "not selected_ip"

    - name: Configure ens19 interface with static IP
      nmcli:
        conn_name: "{{ item.name }}"
        type: "{{ item.type }}"
        state: "{{ item.state }}"
        ifname: ens19
        ip4: "{{ item.ip }}"
      loop: "{{ network_connection_static }}"
      loop_control:
        loop_var: item

    - name: Configure ens18 interface with DHCP
      nmcli:
        conn_name: dhcp-network
        type: ethernet
        state: up
        ifname: ens18
        ip4: "dhcp"  # This indicates DHCP configuration
      loop_control:
        loop_var: item
